
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>{title}</title>
	<style>
		:root{
			--bg:#0e1114;
			--panel:#11151a;
			--muted:#9aa6b2;
			--stdout:#0b3d91; /* dark blue */
			--stderr:#7a0000; /* dark red */
			--ansi:#8a6b00;   /* dark yellow */
			--html:#3f3f46;   /* gray */
			--accent: #1f6feb;
			--radius:6px;
		}
		html,body{height:100%;margin:0;background:var(--bg);color:var(--muted);font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;font-size:13px}
		.wrap{max-width:1200px;margin:0 auto;padding:12px 16px;margin-left:220px;transition:margin-left .22s ease}
		
		h1.site-title{margin:0 0 8px 0;font-weight:600;color:#fff;font-size:16px}

		/* log area */
		.log{display:block}
		.chunk{position:relative;margin:6px 0;padding:6px 10px;border-radius:6px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03);overflow:hidden}
		.chunk + .chunk{margin-top:8px}
		.chunk pre{margin:0;font-family:inherit;white-space:pre-wrap;line-height:1.2;font-size:12px;padding:2px 0;overflow:visible}
		.chunk.collapsed{overflow:hidden}
		.chunk.collapsed pre{max-height:50px;overflow:hidden}

		/* top-right label */
		.chunk .label{position:absolute;right:8px;top:8px;display:flex;gap:6px;align-items:center}
		.chunk .label button{appearance:none;border:0;padding:4px 8px;border-radius:999px;font-size:11px;color:#fff;cursor:pointer;background:rgba(0,0,0,0.15)}
		.chunk .label button.toggle{background:rgba(0,0,0,0.25)}
		.chunk .label button.open{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.02)}

		/* type colors */
		.chunk.stdout{border-left:4px solid var(--stdout)}
		.chunk.stdout .label button.toggle{background:var(--stdout)}
		.chunk.stderr{border-left:4px solid var(--stderr)}
		.chunk.stderr .label button.toggle{background:var(--stderr)}
		.chunk.ansi-cursor, .chunk.ansi{border-left:4px solid var(--ansi)}
		.chunk.ansi .label button.toggle{background:var(--ansi)}
		.chunk.html-injection{border-left:4px solid var(--html)}
		.chunk.html-injection .label button.toggle{background:var(--html)}

		/* compact header when collapsed */
		.chunk.collapsed{padding:12px 10px;min-height:40px;display:flex;align-items:center}

		/* prettier TOC styles */
		.toc{position:fixed;left:0;top:0;bottom:0;width:200px;overflow:auto;background:linear-gradient(180deg,#071021,#0b131a);padding:2.6rem 12px 12px 12px;border-right:1px solid rgba(255,255,255,0.04);box-shadow:2px 0 12px rgba(0,0,0,0.6);transition:transform .22s ease;z-index:900}
		.toc.closed{transform:translateX(-100%)}
		.toc .toc-section{color:#cfe6ff;margin-bottom:8px;font-size:13px;font-weight:600}
		.toc a{color:var(--muted);text-decoration:none;display:block;padding:4px 6px;border-radius:4px;font-size:12px}
		.toc a:hover{background:rgba(255,255,255,0.02);color:#fff}
		.toc a:before{content:'▸';margin-right:6px;font-size:10px;color:rgba(255,255,255,0.3)}
		.toggle-btn{position:fixed;left:8px;top:8px;z-index:1000;background:#07202a;color:var(--muted);border:1px solid rgba(255,255,255,0.03);padding:6px 8px;border-radius:6px;cursor:pointer}
		.toggle-btn:hover{background:#0a2833;color:#fff}
	</style>
	
	<script>
		function buildTOC() {
			const toc = document.getElementById('logtee-toc');
			if(!toc) return;
			toc.innerHTML = '';
			const sections = Array.from(document.querySelectorAll('h1'));
			const allAnchors = Array.from(document.querySelectorAll('h2'));
			sections.forEach((s, i) => {
				const h = document.createElement('div');
				h.innerHTML = '<strong>'+s.textContent+'</strong>';
				h.className = 'toc-section';
				toc.appendChild(h);
				const nextSection = sections[i + 1];
				const sectionAnchors = allAnchors.filter(a => {
					const afterSection = a.compareDocumentPosition(s) & Node.DOCUMENT_POSITION_PRECEDING;
					if (!nextSection) return afterSection;
					const beforeNext = a.compareDocumentPosition(nextSection) & Node.DOCUMENT_POSITION_FOLLOWING;
					return afterSection && beforeNext;
				});
				sectionAnchors.forEach(a => {
					const l = document.createElement('div');
					l.style.paddingLeft = '8px';
					const ael = document.createElement('a');
					ael.href = '#'+a.id;
					const clone = a.cloneNode(true);
					if (clone.querySelectorAll) {
						clone.querySelectorAll('.anchor-ts').forEach(n => n.remove());
					}
					ael.textContent = (clone.textContent || '').trim();
					l.appendChild(ael);
					toc.appendChild(l);
				});
			});
		}

		function makeLabel(type){
			var btn = document.createElement('button');
			btn.className = 'toggle';
			btn.textContent = (type||'chunk').toUpperCase();
			btn.title = 'Toggle collapse/expand';
			return btn;
		}

		function makeOpen(){
			var btn = document.createElement('button');
			btn.className = 'open';
			btn.textContent = 'Open';
			btn.title = 'Open content in new tab';
			return btn;
		}

		function typeFromClasses(el){
			if(el.classList.contains('stderr')) return 'stderr';
			if(el.classList.contains('stdout')) return 'stdout';
			if(el.classList.contains('ansi')||el.classList.contains('ansi-cursor')) return 'ansi';
			if(el.classList.contains('html-injection')) return 'html';
			return 'log';
		}

		// Delegated click handler
		document.addEventListener('click', function(e){
			var t = e.target;
			if(t.matches('.chunk .label .toggle')){
				// Don't toggle if button is disabled
				if(t.disabled) return;
				var chunk = t.closest('.chunk');
				if(!chunk) return;
				chunk.classList.toggle('collapsed');
			}
			if(t.matches('.chunk .label .open')){
				var chunk = t.closest('.chunk');
				if(!chunk) return;
				var pre = chunk.querySelector('pre');
				if(!pre) return;
				var w = window.open('about:blank','_blank');
				try{
					w.document.open();
					w.document.write(pre.innerHTML);
					w.document.close();
				}catch(err){
					w.document.body.textContent = pre.textContent;
				}
			}
		});

		window.addEventListener('load', buildTOC);

		// Toggle for TOC drawer
		document.addEventListener('DOMContentLoaded', function(){
			const toggle = document.getElementById('logtee-toggle');
			const toc = document.getElementById('logtee-toc');
			const wrap = document.querySelector('.wrap');
			if(!toggle||!toc||!wrap) return;
			
			toggle.addEventListener('click', function(){
				const closed = toc.classList.toggle('closed');
				wrap.style.marginLeft = closed ? '16px' : '220px';
			});

			// Augment chunks created by writer: add labels to existing and future chunks
			function augmentChunk(chunk){
				if(chunk._augmented) return; // idempotent
				chunk._augmented = true;
				
				var type = typeFromClasses(chunk);
				var labelWrap = document.createElement('div');
				labelWrap.className = 'label';
				
				// Always add HTML open button for html chunks
				if(type === 'html'){
					var open = makeOpen();
					labelWrap.appendChild(open);
				}
				
				// Always add toggle button (for type indication)
				var toggle = makeLabel(type);
				
				// Only enable collapse functionality if chunk is taller than 150px
				const chunkHeight = chunk.offsetHeight;
				if(chunkHeight <= 150) {
					toggle.disabled = true;
					toggle.style.opacity = '0.5';
					toggle.style.cursor = 'default';
					toggle.title = 'Chunk too small to collapse';
				}
				
				labelWrap.appendChild(toggle);
				chunk.appendChild(labelWrap);
			}

			// augment existing chunks now
			Array.from(document.querySelectorAll('.log > div, .log > .chunk')).forEach(function(c){
				// if writer uses classes like stdout/stderr/html-injection, mark as chunk
				if(!c.classList.contains('chunk')) c.classList.add('chunk');
				augmentChunk(c);
			});

			// observe mutations to augment new chunks as they are inserted
			var target = document.getElementById('logtee-log');
			if(target){
				var mo = new MutationObserver(function(records){
					records.forEach(function(r){
						r.addedNodes && r.addedNodes.forEach(function(n){
							if(n.nodeType!==1) return;
							if(!n.classList.contains('chunk')) n.classList.add('chunk');
							augmentChunk(n);
						});
					});
				});
				mo.observe(target, {childList:true, subtree:false});
			}
		});
	</script>
</head>
<body>
	<button class="toggle-btn" id="logtee-toggle">☰</button>
	<div class="toc" id="logtee-toc"></div>
	<div class="wrap">
		<h1 class="site-title">{title}</h1>
		<div class="log" id="logtee-log">
			<!-- INSERT_LOG -->
			<!-- LOGTEEHTML_FOOTER -->
			<!-- FOOTER_BEGIN -->
		</div>
	</div>
</body>
</html>

